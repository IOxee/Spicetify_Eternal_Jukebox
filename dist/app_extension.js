(async()=>{for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(t=>setTimeout(t,10));var I,s,A,M,$,z,F,q,U,W,J,e,n,t,r,i,K,H,Q,G,Y,Z,V,X,tt,et,nt,rt,it,st,at,ot,h,a,ct,o,c,ut,u,lt,l,ht,ft,dt,f,pt,d,p,b,bt,gt,yt,g,vt,mt,y,wt,St,xt,Bt,Pt,Et,_t,v,m,kt,Ct,Dt,Ot,jt,Rt,Nt,Tt,Lt,It,At,w,S,Mt,$t,x,zt,Ft,qt;function Ut(t){var e;return null==(e=Spicetify.Platform)?void 0:e[t]}async function Wt(t){return(async t=>{let e=t();for(;void 0===e;)await new Promise(t=>setTimeout(t,100)),e=t();return e})(()=>Ut(t))}async function Jt(t,e){e=await(await(await fetch(`https://raw.githubusercontent.com/Pithaya/spicetify-apps/main/custom-apps/${e}/package.json`)).json()).version;return et(t,e,">=")}function B(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}ot(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function Kt(t,a,o,c){return new(o=o||Promise)(function(n,e){function r(t){try{s(c.next(t))}catch(t){e(t)}}function i(t){try{s(c.throw(t))}catch(t){e(t)}}function s(t){var e;t.done?n(t.value):((e=t.value)instanceof o?e:new o(function(t){t(e)})).then(r,i)}s((c=c.apply(t,a||[])).next())})}function Ht(r,i){var s,a,o,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=t(0),u.throw=t(1),u.return=t(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function t(n){return function(t){var e=[n,t];if(s)throw new TypeError("Generator is already executing.");for(;c=u&&e[u=0]?0:c;)try{if(s=1,a&&(o=2&e[0]?a.return:e[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,e[1])).done)return o;switch(a=0,(e=o?[2&e[0],o.value]:e)[0]){case 0:case 1:o=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,a=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(o=0<(o=c.trys).length&&o[o.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!o||e[1]>o[0]&&e[1]<o[3]))c.label=e[1];else if(6===e[0]&&c.label<o[1])c.label=o[1],o=e;else{if(!(o&&c.label<o[2])){o[2]&&c.ops.pop(),c.trys.pop();continue}c.label=o[2],c.ops.push(e)}}e=i.call(r,c)}catch(t){e=[6,t],a=0}finally{s=o=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}}function P(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function E(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=s.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return a}function _(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function k(t){return this instanceof k?(this.v=t,this):new k(t)}function Qt(t,e,n){var i,s,a;if(Symbol.asyncIterator)return i=n.apply(t,e||[]),s=[],a=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),r("next"),r("throw"),r("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),a[Symbol.asyncIterator]=function(){return this},a;throw new TypeError("Symbol.asyncIterator is not defined.");function r(r,t){i[r]&&(a[r]=function(n){return new Promise(function(t,e){1<s.push([r,n,t,e])||o(r,n)})},t)&&(a[r]=t(a[r]))}function o(t,e){try{(n=i[t](e)).value instanceof k?Promise.resolve(n.value.v).then(c,u):l(s[0][2],n)}catch(t){l(s[0][3],t)}var n}function c(t){o("next",t)}function u(t){o("throw",t)}function l(t,e){t(e),s.shift(),s.length&&o(s[0][0],s[0][1])}}function Gt(a){var t,e;if(Symbol.asyncIterator)return(t=a[Symbol.asyncIterator])?t.call(a):(a=P(a),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);throw new TypeError("Symbol.asyncIterator is not defined.");function n(s){e[s]=a[s]&&function(i){return new Promise(function(t,e){var n,r;i=a[s](i),n=t,t=e,r=i.done,e=i.value,Promise.resolve(e).then(function(t){n({value:t,done:r})},t)})}}}function C(t){return"function"==typeof t}function Yt(t){t=t(function(t){Error.call(t),t.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t}function Zt(t,e){t&&0<=(e=t.indexOf(e))&&t.splice(e,1)}function D(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}function Vt(t){return t instanceof a||t&&"closed"in t&&C(t.remove)&&C(t.add)&&C(t.unsubscribe)}function Xt(t){C(t)?t():t.unsubscribe()}function te(e){c.setTimeout(function(){var t=o.onUnhandledError;if(!t)throw e;t(e)})}function ee(){}function ne(t,e,n){return{kind:t,value:e,error:n}}function O(t){if(o.useDeprecatedSynchronousErrorHandling){var e=!u;if(e&&(u={errorThrown:!1,error:null}),t(),e){var e=u,n=e.errorThrown;if(u=null,n)throw e.error}}else t()}function j(t){var e=lt.call(this)||this;return e.isStopped=!1,t?Vt(e.destination=t)&&t.add(e):e.destination=pt,e}function re(t,e){return ht.call(t,e)}function ie(t){this.partialObserver=t}function se(t,e,n){var r=dt.call(this)||this;return n=C(t)||!t?{next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=n?n:void 0}:r&&o.useDeprecatedNextContext?((e=Object.create(t)).unsubscribe=function(){return r.unsubscribe()},{next:t.next&&re(t.next,e),error:t.error&&re(t.error,e),complete:t.complete&&re(t.complete,e)}):t,r.destination=new ft(n),r}function ae(t){var e;o.useDeprecatedSynchronousErrorHandling?(e=t,o.useDeprecatedSynchronousErrorHandling&&u&&(u.errorThrown=!0,u.error=e)):te(t)}function oe(t,e){var n=o.onStoppedNotification;n&&c.setTimeout(function(){return n(t,e)})}function ce(t){return t}function R(t){t&&(this._subscribe=t)}function ue(t){return null!=(t=null!=t?t:o.Promise)?t:Promise}function le(n){return function(t){if(C(null==(e=t)?void 0:e.lift))return t.lift(function(t){try{return n(t,this)}catch(t){this.error(t)}});var e;throw new TypeError("Unable to lift unknown Observable type")}}function he(t,e,n,r,i){return new bt(t,e,n,r,i)}function fe(e,n,t,r,i,s){var a=b.call(this,e)||this;return a.onFinalize=i,a.shouldUnsubscribe=s,a._next=n?function(t){try{n(t)}catch(t){e.error(t)}}:b.prototype._next,a._error=r?function(t){try{r(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:b.prototype._error,a._complete=t?function(){try{t()}catch(t){e.error(t)}finally{this.unsubscribe()}}:b.prototype._complete,a}function N(){var t=gt.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}function T(t,e){var n=vt.call(this)||this;return n.destination=t,n.source=e,n}function L(t){var e=y.call(this)||this;return e._value=t,e}function de(t){if(t instanceof p)return t;if(null!=t){if(C(t[d]))return i=t,new p(function(t){var e=i[d]();if(C(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(St(t))return r=t,new p(function(t){for(var e=0;e<r.length&&!t.closed;e++)t.next(r[e]);t.complete()});if(C(null==(e=t)?void 0:e.then))return n=t,new p(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,te)});if(e=t,Symbol.asyncIterator&&C(null==e?void 0:e[Symbol.asyncIterator]))return pe(t);if(C(null==(e=t)?void 0:e[xt]))return a=t,new p(function(t){var e,n;try{for(var r=P(a),i=r.next();!i.done;i=r.next()){var s=i.value;if(t.next(s),t.closed)return}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}t.complete()});if(C(null==(e=t)?void 0:e.getReader))return pe(function(i){return Qt(this,arguments,function(){var e,n,r;return Ht(this,function(t){switch(t.label){case 0:e=i.getReader(),t.label=1;case 1:t.trys.push([1,,9,10]),t.label=2;case 2:return[4,k(e.read())];case 3:return(n=t.sent(),r=n.value,n.done)?[4,k(void 0)]:[3,5];case 4:return[2,t.sent()];case 5:return[4,k(r)];case 6:return[4,t.sent()];case 7:return t.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}(t))}var a,n,r,i,e;throw e=t,new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function pe(t){return new p(function(e){!function(n,r){var i,s,a,o;return Kt(this,void 0,void 0,function(){var e;return Ht(this,function(t){switch(t.label){case 0:t.trys.push([0,5,6,11]),i=Gt(n),t.label=1;case 1:return[4,i.next()];case 2:if((s=t.sent()).done)return[3,4];if(e=s.value,r.next(e),r.closed)return[2];t.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return e=t.sent(),a={error:e},[3,11];case 6:return(t.trys.push([6,,9,10]),s&&!s.done&&(o=i.return))?[4,o.call(i)]:[3,8];case 7:t.sent(),t.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return r.complete(),[2]}})})}(t,e).catch(function(t){return e.error(t)})})}function be(r,i){return le(function(t,e){var n=0;t.subscribe(he(e,function(t){e.next(r.call(i,t,n++))}))})}function ge(n){return be(function(t){return e=n,Bt(t=t)?e.apply(void 0,_([],E(t))):e(t);var e})}function ye(t,a,n,r,i,s,o,e){var c=[],u=0,l=0,h=!1,f=function(){!h||c.length||u||a.complete()},d=function(t){return u<r?p(t):c.push(t)},p=function(t){s&&a.next(t),u++;var e=!1;de(n(t,l++)).subscribe(he(a,function(t){null!=i&&i(t),s?d(t):a.next(t)},function(){e=!0},void 0,function(){if(e)try{u--;for(;c.length&&u<r;)(()=>{var t,e,n,r,i,s=c.shift();o?(t=a,n=function(){p(s)},void 0===r&&(r=0),void 0===i&&(i=!1),e=(e=o).schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r),t.add(e)):p(s)})();f()}catch(t){a.error(t)}}))};return t.subscribe(he(a,d,function(){h=!0,f()})),function(){null!=e&&e()}}function ve(n,r,i,t){if(C(i)&&(t=i,i=void 0),t)return ve(n,r,i).pipe(ge(t));var t=E(C((t=n).addEventListener)&&C(t.removeEventListener)?Et.map(function(e){return function(t){return n[e](r,t,i)}}):C((t=n).addListener)&&C(t.removeListener)?Pt.map(me(n,r)):C((t=n).on)&&C(t.off)?_t.map(me(n,r)):[],2),e=t[0],s=t[1];if(!e&&St(n))return function t(i,s,n){return void 0===n&&(n=1/0),C(s)?t(function(n,r){return be(function(t,e){return s(n,t,r,e)})(de(i(n,r)))},n):("number"==typeof s&&(n=s),le(function(t,e){return ye(t,e,i,n)}))}(function(t){return ve(t,r,i)})(de(n));if(e)return new p(function(n){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.next(1<t.length?t:t[0])}return e(t),function(){return s(t)}});throw new TypeError("Invalid event target")}function me(n,r){return function(e){return function(t){return n[e](r,t)}}}function we(t,e){return t===e}async function Se(e){try{return n="https://api.spotify.com/v1/audio-analysis/"+e,t=await Wt("Session"),await(await fetch(n,{headers:{Authorization:"Bearer "+t.accessToken}})).json()}catch(t){return(e=t)instanceof Tt&&console.error(e.message),void 0!==(n=e).status&&void 0!==n.message?console.error(e.message):console.error("Unknown error.",e),null}var n,t}function xe(t,e,s,a){{var o=x.useEffect,c=[t,e,s,a];let n=(0,x.useRef)(c),r=(0,x.useRef)(),i=(0,x.useRef)();zt(()=>{n.current=c,r.current=Ft(c)}),o(()=>{let e=n.current[0],t=(r.current||(r.current=Ft(n.current)),e.subscribe({next:t=>{e===n.current[0]&&r.current.next?.(t)},error:t=>{e===n.current[0]&&(r.current.error?r.current:console).error(t)},complete:()=>{e===n.current[0]&&r.current.complete?.()}}));return i.current=t,()=>{t.unsubscribe()}},[c[0]]),i}}function Be(){var[t,e]=(0,w.useState)(!1);return xe(window.jukebox.stateChanged$,e),w.default.createElement(Spicetify.ReactComponent.TooltipWrapper,{label:"Enable jukebox",showDelay:100,renderInline:!1},w.default.createElement("button",{className:"main-repeatButton-button "+(t?"main-repeatButton-active":""),onClick:async function(){await window.jukebox.setEnabled(!window.jukebox.isEnabled)}},w.default.createElement($t,{size:24})))}I=Object.create,s=Object.defineProperty,A=Object.defineProperties,M=Object.getOwnPropertyDescriptor,$=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertyNames,F=Object.getOwnPropertySymbols,q=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable,J=(t,e,n)=>e in t?s(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,e=(t,e)=>{for(var n in e=e||{})U.call(e,n)&&J(t,n,e[n]);if(F)for(var n of F(e))W.call(e,n)&&J(t,n,e[n]);return t},n=(t,e)=>A(t,$(e)),r=(t,e,n)=>(n=null!=t?I(q(t)):{},((e,n,r,i)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let t of z(n))U.call(e,t)||t===r||s(e,t,{get:()=>n[t],enumerable:!(i=M(n,t))||i.enumerable});return e})(!e&&t&&t.__esModule?n:s(n,"default",{value:t,enumerable:!0}),t)),i=(t=(t,e)=>function(){return e||(0,t[z(t)[0]])((e={exports:{}}).exports,e),e.exports})({"external-global-plugin:react"(t,e){e.exports=Spicetify.React}}),K=r(t({"external-global-plugin:react-dom"(t,e){e.exports=Spicetify.ReactDOM}})()),H=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Q=t=>{if("string"!=typeof t)throw new TypeError("Invalid argument expected string");var e=t.match(H);if(e)return e.shift(),e;throw new Error(`Invalid argument not valid semver ('${t}' received)`)},G=t=>"*"===t||"x"===t||"X"===t,Y=t=>{var e=parseInt(t,10);return isNaN(e)?t:e},Z=(t,e)=>typeof t!=typeof e?[String(t),String(e)]:[t,e],V=(t,e)=>G(t)||G(e)?0:([t,e]=Z(Y(t),Y(e)),e<t?1:t<e?-1:0),X=(e,n)=>{for(let t=0;t<Math.max(e.length,n.length);t++){var r=V(e[t]||"0",n[t]||"0");if(0!==r)return r}return 0},tt=(t,e)=>{var t=Q(t),e=Q(e),n=t.pop(),r=e.pop(),t=X(t,e);return 0!==t?t:n&&r?X(n.split("."),r.split(".")):n||r?n?-1:1:0},et=(t,e,n)=>{it(n);t=tt(t,e);return nt[n].includes(t)},nt={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},rt=Object.keys(nt),it=t=>{if("string"!=typeof t)throw new TypeError("Invalid operator type, expected string but got "+typeof t);if(-1===rt.indexOf(t))throw new Error("Invalid operator, expected one of "+rt.join("|"))},st=class{constructor(t){t={bars:t.bars.map(t=>this.toRemixed(t)),beats:t.beats.map(t=>this.toRemixed(t)),sections:t.sections.map(t=>this.toRemixedSection(t)),segments:t.segments.map(t=>this.toRemixedSegment(t)),tatums:t.tatums.map(t=>this.toRemixed(t))};this.analysis=t}toRemixed(t){return n(e({},t),{firstOverlappingSegment:void 0,overlappingSegments:[],children:[],parent:void 0,indexInParent:0,prev:void 0,next:void 0,index:0})}toRemixedSection(t){return n(e({},t),{children:[],prev:void 0,next:void 0,index:0})}toRemixedSegment(t){return n(e({},t),{parent:void 0,indexInParent:0,prev:void 0,next:void 0,index:0})}remixTrack(){return this.preprocessTrack()}preprocessTrack(){var t;for(t of["sections","bars","beats","tatums","segments"]){var e,n,r=this.analysis[t];for([e,n]of r.entries())0<(n.index=e)?n.prev=r[e-1]:n.prev=null,e<r.length-1?n.next=r[e+1]:n.next=null}return this.connectQuanta(this.analysis.sections,this.analysis.bars),this.connectQuanta(this.analysis.bars,this.analysis.beats),this.connectQuanta(this.analysis.beats,this.analysis.tatums),this.connectQuanta(this.analysis.tatums,this.analysis.segments),this.connectFirstOverlappingSegment(this.analysis,this.analysis.bars),this.connectFirstOverlappingSegment(this.analysis,this.analysis.beats),this.connectFirstOverlappingSegment(this.analysis,this.analysis.tatums),this.connectAllOverlappingSegments(this.analysis,this.analysis.bars),this.connectAllOverlappingSegments(this.analysis,this.analysis.beats),this.connectAllOverlappingSegments(this.analysis,this.analysis.tatums),this.analysis}connectQuanta(t,e){let n=0;for(var r of t){r.children=[];for(let t=n;t<e.length;t++){var i=e[t];if(i.start>=r.start&&i.start<r.start+r.duration)i.parent=r,i.indexInParent=r.children.length,r.children.push(i),n=t;else if(i.start>r.start)break}}}connectFirstOverlappingSegment(t,e){let n=0;var r,i=t.segments;for(r of e)for(let t=n;t<i.length;t++){var s=i[t];if(s.start>=r.start){r.firstOverlappingSegment=s,n=t;break}}}connectAllOverlappingSegments(t,e){let n=0;var r,i=t.segments;for(r of e){r.overlappingSegments=[];for(let t=n;t<i.length;t++){var s=i[t];if(!(s.start+s.duration<r.start)){if(s.start>r.start+r.duration)break;n=t,r.overlappingSegments.push(s)}}}}},at=class{constructor(t,e,n){this.beatsPlayed=0,this.startTime=0,this.currentRandomBranchChance=0,this.track=t,this.analysis=e,this.graph=n,this.currentRandomBranchChance=window.jukebox.settings.minRandomBranchChance,this.startTime=(new Date).getTime()}},ot=function(t,e){return(ot=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(t,e)},h=Yt(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}),D.prototype.unsubscribe=function(){var e,t,n;if(!this.closed){this.closed=!0;var r=this._parentage;if(r)if(this._parentage=null,Array.isArray(r))try{for(var i=P(r),s=i.next();!s.done;s=i.next())s.value.remove(this)}catch(t){o={error:t}}finally{try{s&&!s.done&&(a=i.return)&&a.call(i)}finally{if(o)throw o.error}}else r.remove(this);var a=this.initialTeardown;if(C(a))try{a()}catch(t){n=t instanceof h?t.errors:[t]}var o=this._finalizers;if(o){this._finalizers=null;try{for(var c=P(o),u=c.next();!u.done;u=c.next()){var l=u.value;try{Xt(l)}catch(t){n=null!=n?n:[],t instanceof h?n=_(_([],E(n)),E(t.errors)):n.push(t)}}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}}if(n)throw new h(n)}},D.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)Xt(t);else{if(t instanceof D){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!=(e=this._finalizers)?e:[]).push(t)}},D.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},D.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},D.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&Zt(e,t)},D.prototype.remove=function(t){var e=this._finalizers;e&&Zt(e,t),t instanceof D&&t._removeParent(this)},D.EMPTY=((t=new D).closed=!0,t),ct=(a=D).EMPTY,o={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},c={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=c.delegate;return null!=i&&i.setTimeout?i.setTimeout.apply(i,_([t,e],E(n))):setTimeout.apply(void 0,_([t,e],E(n)))},clearTimeout:function(t){var e=c.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0},ut=ne("C",void 0,void 0),u=null,B(j,lt=a),j.create=function(t,e,n){return new f(t,e,n)},j.prototype.next=function(t){this.isStopped?oe(ne("N",t,void 0),this):this._next(t)},j.prototype.error=function(t){this.isStopped?oe(ne("E",void 0,t),this):(this.isStopped=!0,this._error(t))},j.prototype.complete=function(){this.isStopped?oe(ut,this):(this.isStopped=!0,this._complete())},j.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,lt.prototype.unsubscribe.call(this),this.destination=null)},j.prototype._next=function(t){this.destination.next(t)},j.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},j.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},l=j,ht=Function.prototype.bind,ie.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){ae(t)}},ie.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){ae(t)}else ae(t)},ie.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){ae(t)}},ft=ie,B(se,dt=l),f=se,pt={closed:!0,next:ee,error:function(t){throw t},complete:ee},d="function"==typeof Symbol&&Symbol.observable||"@@observable",R.prototype.lift=function(t){var e=new R;return e.source=this,e.operator=t,e},R.prototype.subscribe=function(t,e,n){var r,i=this,s=(r=t)&&r instanceof l||(t=>t&&C(t.next)&&C(t.error)&&C(t.complete))(r)&&Vt(r)?t:new f(t,e,n);return O(function(){var t=i.operator,e=i.source;s.add(t?t.call(s,e):e?i._subscribe(s):i._trySubscribe(s))}),s},R.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},R.prototype.forEach=function(r,t){var i=this;return new(t=ue(t))(function(t,e){var n=new f({next:function(t){try{r(t)}catch(t){e(t),n.unsubscribe()}},error:e,complete:t});i.subscribe(n)})},R.prototype._subscribe=function(t){var e;return null==(e=this.source)?void 0:e.subscribe(t)},R.prototype[d]=function(){return this},R.prototype.pipe=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(0===(e=t).length?ce:1===e.length?e[0]:function(t){return e.reduce(function(t,e){return e(t)},t)})(this)},R.prototype.toPromise=function(t){var r=this;return new(t=ue(t))(function(t,e){var n;r.subscribe(function(t){return n=t},function(t){return e(t)},function(){return t(n)})})},R.create=function(t){return new R(t)},p=R,B(fe,b=l),fe.prototype.unsubscribe=function(){var t;this.shouldUnsubscribe&&!this.shouldUnsubscribe()||(t=this.closed,b.prototype.unsubscribe.call(this),t)||null==(t=this.onFinalize)||t.call(this)},bt=fe,yt=Yt(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),B(N,gt=p),N.prototype.lift=function(t){var e=new mt(this,this);return e.operator=t,e},N.prototype._throwIfClosed=function(){if(this.closed)throw new yt},N.prototype.next=function(i){var s=this;O(function(){var e,t;if(s._throwIfClosed(),!s.isStopped){s.currentObservers||(s.currentObservers=Array.from(s.observers));try{for(var n=P(s.currentObservers),r=n.next();!r.done;r=n.next())r.value.next(i)}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}})},N.prototype.error=function(e){var n=this;O(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=e;for(var t=n.observers;t.length;)t.shift().error(e)}})},N.prototype.complete=function(){var e=this;O(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},N.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(N.prototype,"observed",{get:function(){var t;return 0<(null==(t=this.observers)?void 0:t.length)},enumerable:!1,configurable:!0}),N.prototype._trySubscribe=function(t){return this._throwIfClosed(),gt.prototype._trySubscribe.call(this,t)},N.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},N.prototype._innerSubscribe=function(t){var e=this,n=this.hasError,r=this.isStopped,i=this.observers;return n||r?ct:(this.currentObservers=null,i.push(t),new a(function(){e.currentObservers=null,Zt(i,t)}))},N.prototype._checkFinalizedStatuses=function(t){var e=this.hasError,n=this.thrownError,r=this.isStopped;e?t.error(n):r&&t.complete()},N.prototype.asObservable=function(){var t=new p;return t.source=this,t},N.create=function(t,e){return new mt(t,e)},B(T,vt=g=N),T.prototype.next=function(t){var e,n;null!=(n=null==(e=this.destination)?void 0:e.next)&&n.call(e,t)},T.prototype.error=function(t){var e,n;null!=(n=null==(e=this.destination)?void 0:e.error)&&n.call(e,t)},T.prototype.complete=function(){var t,e;null!=(e=null==(t=this.destination)?void 0:t.complete)&&e.call(t)},T.prototype._subscribe=function(t){var e;return null!=(e=null==(e=this.source)?void 0:e.subscribe(t))?e:ct},mt=T,B(L,y=g),Object.defineProperty(L.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),L.prototype._subscribe=function(t){var e=y.prototype._subscribe.call(this,t);return e.closed||t.next(this._value),e},L.prototype.getValue=function(){var t=this.hasError,e=this.thrownError,n=this._value;if(t)throw e;return this._throwIfClosed(),n},L.prototype.next=function(t){y.prototype.next.call(this,this._value=t)},wt=L,St=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t},xt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",Bt=Array.isArray,Pt=["addListener","removeListener"],Et=["addEventListener","removeEventListener"],_t=["on","off"],(m=v=class{constructor(){this.maxBranchDistance=v.defaultBranchDistance,this.useDynamicBranchDistance=!1,this.minRandomBranchChance=v.defaultMinRandomBranchChance,this.maxRandomBranchChance=v.defaultMaxRandomBranchChance,this.randomBranchChanceDelta=v.defaultRandomBranchChanceDelta,this.maxJukeboxPlayTime=0,this.addLastEdge=!0,this.justBackwards=!1,this.justLongBranches=!1,this.removeSequentialBranches=!1,this.alwaysFollowLastBranch=!0}static fromPartial(t){var e=new v;return e.maxBranchDistance=t.maxBranchDistance,e.useDynamicBranchDistance=t.useDynamicBranchDistance,e.minRandomBranchChance=t.minRandomBranchChance,e.maxRandomBranchChance=t.maxRandomBranchChance,e.randomBranchChanceDelta=t.randomBranchChanceDelta,e.addLastEdge=t.addLastEdge,e.justBackwards=t.justBackwards,e.justLongBranches=t.justLongBranches,e.removeSequentialBranches=t.removeSequentialBranches,e.alwaysFollowLastBranch=t.alwaysFollowLastBranch,e.maxJukeboxPlayTime=t.maxJukeboxPlayTime,e}toPartial(){return{maxBranchDistance:this.maxBranchDistance,useDynamicBranchDistance:this.useDynamicBranchDistance,minRandomBranchChance:this.minRandomBranchChance,maxRandomBranchChance:this.maxRandomBranchChance,randomBranchChanceDelta:this.randomBranchChanceDelta,addLastEdge:this.addLastEdge,justBackwards:this.justBackwards,justLongBranches:this.justLongBranches,removeSequentialBranches:this.removeSequentialBranches,alwaysFollowLastBranch:this.alwaysFollowLastBranch,maxJukeboxPlayTime:this.maxJukeboxPlayTime}}}).minBeatsBeforeBranching=5,m.rangeMinBranchDistance=2,m.rangeMaxBranchDistance=80,m.defaultBranchDistance=30,m.defaultMinRandomBranchChance=.18,m.defaultMaxRandomBranchChance=.5,m.minRandomBranchChanceDelta=0,m.maxRandomBranchChanceDelta=.2,kt=class{constructor(t=[]){this.beats=[],this.lastBranchPoint=0,this.longestReach=0,this.beats=t}},Ct=class{get id(){return this.source.index+"-"+this.destination.index}constructor(t,e,n){this.source=t,this.destination=e,this.distance=n,this.isPlaying=!1,this.deleted=!1}},Dt=class{constructor(t,e,n){this.isPlaying=!1,this.next=null,this.previous=null,this.neighbours=[],this.playCount=0,this.index=t,this.start=e,this.duration=n}get end(){return this.start+this.duration}toString(){return`[${this.index}]: ${this.start} - ${this.end} (${this.duration})`}isInBeat(t){return t>=this.start&&t<=this.end}},Ot=class{constructor(t,e){this.settings=t,this.beats=e,this.allEdges=[],this.allNeighbours=[],this.minLongBranch=0,this.computedMaxBranchDistance=0,this.maxBranches=4,this.graph=new kt,this.allNeighbours=e.map(()=>[]),this.minLongBranch=e.length/5}generateGraph(){var t,e,n=this.beats.map(t=>new Dt(t.index,1e3*t.start,1e3*t.duration));for([t,e]of n.entries())t<n.length-1&&(e.next=n[t+1]),0<t&&(e.previous=n[t-1]);return this.graph=new kt(n),this.precalculateNearestNeighbors(),this.settings.useDynamicBranchDistance?this.dynamicCollectNearestNeighbors():(this.collectNearestNeighbors(this.settings.maxBranchDistance),this.computedMaxBranchDistance=this.settings.maxBranchDistance),this.postProcessNearestNeighbors(),this.graph}dynamicCollectNearestNeighbors(){var t=this.beats.length/6;let e;for(e=10;e<m.rangeMaxBranchDistance&&!(t<=this.collectNearestNeighbors(e));e+=5);this.computedMaxBranchDistance=e}precalculateNearestNeighbors(){if(0===this.allEdges.length)for(var t of this.beats)this.calculateNearestNeighborsForBeat(t)}calculateNearestNeighborsForBeat(n){var t,r,e=this.maxBranches,i=m.rangeMaxBranchDistance,s=[];for([t,r]of this.beats.entries())if(t!==n.index){let e=0;for(var[a,o]of n.overlappingSegments.entries()){let t=100;a<r.overlappingSegments.length&&(a=r.overlappingSegments[a],t=o.index===a.index?100:this.getSegmentsDistance(o,a)),e+=t}var c=n.indexInParent===r.indexInParent?0:100,c=e/n.overlappingSegments.length+c;c<i&&(c=new Ct(this.graph.beats[n.index],this.graph.beats[t],c),s.push(c))}s.sort((t,e)=>t.distance>e.distance?1:e.distance>t.distance?-1:0);for(let t=0;t<e&&t<s.length;t++){var u=s[t];this.allNeighbours[n.index].push(u),this.allEdges.push(u)}}getSegmentsDistance(t,e){return+this.getEuclideanDistance(t.timbre,e.timbre)+10*this.getEuclideanDistance(t.pitches,e.pitches)+ +Math.abs(t.loudness_start-e.loudness_start)+ +Math.abs(t.loudness_max-e.loudness_max)+100*Math.abs(t.duration-e.duration)+ +Math.abs(t.confidence-e.confidence)}getEuclideanDistance(e,n){let r=0;for(let t=0;t<e.length;t++){var i=n[t]-e[t];r+=i*i}return Math.sqrt(r)}collectNearestNeighbors(t){let e=0;for(var[n,r]of this.graph.beats.entries())r.neighbours=this.filterNearestNeighbors(n,t),0<r.neighbours.length&&(e+=1);return e}filterNearestNeighbors(e,n){return this.allNeighbours[e].filter(t=>!t.deleted&&!(this.settings.justBackwards&&t.destination.index>e||this.settings.justLongBranches&&Math.abs(t.destination.index-e)<this.minLongBranch)&&t.distance<=n)}postProcessNearestNeighbors(){this.settings.addLastEdge&&this.insertBestBackwardBranch(this.computedMaxBranchDistance,this.longestBackwardBranch()<50?65:55),this.graph.lastBranchPoint=this.findBestLastBeat(),this.filterOutBadBranches(),this.settings.removeSequentialBranches&&this.filterOutSequentialBranches()}longestBackwardBranch(){let t=0;for(var e of this.graph.beats)for(var n of e.neighbours){n=e.index-n.destination.index;n>t&&(t=n)}return 100*t/this.beats.length}insertBestBackwardBranch(t,e){var n,r,i,s,a=[];for([n,r]of this.graph.beats.entries())for(var o of this.allNeighbours[n]){var c=o.destination.index,u=o.distance,l=n-c;0<l&&u<e&&(u=100*l/this.graph.beats.length,a.push({percentDistance:u,beatIndex:n,otherBeatIndex:c,currentBeat:r,edge:o}))}0!==a.length&&(a.sort((t,e)=>t.percentDistance-e.percentDistance),a.reverse(),s=(i=a[0]).currentBeat,t<(t=i.edge).distance)&&s.neighbours.push(t)}calculateReachability(){let n=this.graph.beats.map(t=>0);this.graph.beats.forEach((t,e)=>{n[e]=this.graph.beats.length-e});for(let t=0;t<1e3;t++){let e=0;for(var[r,i]of this.graph.beats.entries()){let t=!1;for(var s of i.neighbours){s=n[s.destination.index];s>n[r]&&(n[r]=s,t=!0)}if(r<this.graph.beats.length-1&&(i=n[r+1])>n[r]&&(n[r]=i,t=!0),t){e++;for(let t=0;t<r;t++)n[t]<n[r]&&(n[t]=n[r])}}if(0===e)break}return n}findBestLastBeat(){var e=this.calculateReachability();let n=0,r=0;for(let t=this.graph.beats.length-1;0<=t;t--){var i=this.graph.beats[t],s=this.graph.beats.length-t,s=100*(e[t]-s)/this.beats.length;if(s>r&&0<i.neighbours.length&&(r=s,n=t,50<=s))break}return this.graph.longestReach=r,n}filterOutBadBranches(){let e=this.graph.lastBranchPoint;for(let t=0;t<e;t++){var n=this.graph.beats[t];n.neighbours=n.neighbours.filter(t=>t.destination.index<e)}}filterOutSequentialBranches(){for(let t=this.graph.beats.length-1;1<=t;t--){let e=this.graph.beats[t];e.neighbours=e.neighbours.filter(t=>!this.hasSequentialBranch(e,t))}}hasSequentialBranch(t,e){if(t.index!==this.graph.lastBranchPoint){var n=t.previous;if(null!==n){var r,i=t.index-e.destination.index;for(r of n.neighbours)if(i==n.index-r.destination.index)return!0}}return!1}},m.defaultRandomBranchChanceDelta=.018,jt=class{constructor(t,e){this.songState=t,this.settings=e,this.playerSubscription=new a,this.currentBeat=null,this.bouncing=!1,this.bounceSeed=null,this.bounceCount=0,this.lastBranch=null,this.isSeekingResolver=null,this.beatsSinceLastBranch=0,this.onProgressSubject=new g,this.onProgress$=this.onProgressSubject.asObservable(),this.onBounceKeyDown=t=>{"Shift"===t.key&&(this.bouncing=!0)},this.onBounceKeyUp=t=>{"Shift"===t.key&&(this.bouncing=!1)}}start(){this.logDebug("Driver started."),document.addEventListener("keydown",this.onBounceKeyDown),document.addEventListener("keyup",this.onBounceKeyUp);var s,a,t=ve(Spicetify.Player,"onprogress").pipe(be(t=>t.data),(void 0===a&&(a=ce),s=null!=s?s:we,le(function(t,n){var r,i=!0;t.subscribe(he(n,function(t){var e=a(t);!i&&s(r,e)||(i=!1,r=e,n.next(t))}))}))).subscribe(t=>{this.process(t)});this.playerSubscription.add(t)}async process(t){var e;if(null!==this.isSeekingResolver){if(this.logDebug(`Is seeking... ${t} -> `+(null==(n=this.currentBeat)?void 0:n.start)),!this.isSeekingResolver(t))return;this.isSeekingResolver=null}if(this.logDebug(`Processing with current beat: ${null==(n=this.currentBeat)?void 0:n.toString()}, player time: `+Spicetify.Player.getProgress()),null!==this.lastBranch&&this.setLastBranchPlaying(!1),null!==this.currentBeat){if(this.currentBeat.isInBeat(t))return;this.currentBeat.isPlaying=!1}this.beatsSinceLastBranch++;var n=null==(n=null==(n=this.currentBeat)?void 0:n.next)?void 0:n.end,r=null==(r=null==(r=this.currentBeat)?void 0:r.previous)?void 0:r.start,n=null!=n&&n<t||null!=r&&t<r,r=(n&&console.error(`Out of sync ! ${t} - `+(null==(r=this.currentBeat)?void 0:r.toString())),this.currentBeat);this.currentBeat=this.getNextBeat(t,n),null!==this.currentBeat&&(this.logDebug(`Got next beat: ${null==(e=this.currentBeat)?void 0:e.index}, with time: ${null==(e=this.currentBeat)?void 0:e.start} - ${null==(e=this.currentBeat)?void 0:e.end}, player time: `+Spicetify.Player.getProgress()),await this.playBeat(r,this.currentBeat,t,n),this.currentBeat.playCount+=1,this.songState.beatsPlayed+=1,null!==r&&(r.isPlaying=!1),this.currentBeat.isPlaying=!0,this.onProgressSubject.next())}async playBeat(t,n,r,i){if(null!==t&&t.index+1!==n.index&&!i){i=Spicetify.Player.getProgress()-t.end;let e=n.start+i;this.logDebug(`Seek to: ${e}ms, from ${r}ms, with offset `+i);t=e>Spicetify.Player.getProgress();this.isSeekingResolver=t?t=>t>=e:t=>t<=e+1e3,this.logDebug(`Time to get there: ${Math.abs(Spicetify.Player.getProgress()-r)}ms`),await(t=>{var e=Ut(t);if(void 0===e)throw new Error(`Platform API "${t}" is not available`);return e})("PlayerAPI").seekTo(e)}}getNextBeat(t,e){if(null===this.currentBeat||e){for(var n of this.songState.graph.beats)if(t>=n.start&&t<=n.end)return n;return this.songState.graph.beats[0]}return this.bouncing?(null===this.bounceSeed&&(this.bounceSeed=this.currentBeat,this.bounceCount=0),this.bounceCount++%2==1?this.selectNextNeighbor(this.bounceSeed):this.bounceSeed):null!=this.bounceSeed?(e=this.bounceSeed,this.bounceSeed=null,e):(e=this.currentBeat.index+1)>=this.songState.graph.beats.length?(this.stop(),null):this.selectRandomNextBeat(this.songState.graph.beats[e])}selectRandomNextBeat(t){var e;return 0!==t.neighbours.length&&this.shouldRandomBranch(t)?(e=t.neighbours.shift(),t.neighbours.push(e),this.beatsSinceLastBranch=0,this.lastBranch=e,this.setLastBranchPlaying(!0),e.destination):t}setLastBranchPlaying(t){null!==this.lastBranch&&(this.lastBranch.isPlaying=t,this.lastBranch.source.isPlaying=t,this.lastBranch.destination.isPlaying=t)}selectNextNeighbor(t){var e;return 0===t.neighbours.length?t:(e=t.neighbours.shift(),t.neighbours.push(e),this.lastBranch=e,this.setLastBranchPlaying(!0),e.destination)}shouldRandomBranch(t){if(t.index===this.songState.graph.lastBranchPoint&&this.settings.alwaysFollowLastBranch)return!0;if(this.beatsSinceLastBranch<=m.minBeatsBeforeBranching)return!1;t=(new Date).getTime()-this.songState.startTime;if(0<this.settings.maxJukeboxPlayTime&&t>this.settings.maxJukeboxPlayTime)return this.songState.currentRandomBranchChance=0,!1;this.songState.currentRandomBranchChance=Math.min(this.songState.currentRandomBranchChance+this.settings.randomBranchChanceDelta,this.settings.maxRandomBranchChance);t=Math.random()<this.songState.currentRandomBranchChance;return t&&(this.songState.currentRandomBranchChance=this.settings.minRandomBranchChance),t}stop(){this.playerSubscription.unsubscribe(),this.playerSubscription=new a,document.removeEventListener("keydown",this.onBounceKeyDown),document.removeEventListener("keyup",this.onBounceKeyUp)}logDebug(t){}},(Nt=Rt=class{static get settings(){return m.fromPartial(Rt.storedSettings)}static set settings(t){Rt.storedSettings=t.toPartial()}static get storedSettings(){var t=Spicetify.LocalStorage.get(this.settingId);return null==t?(new m).toPartial():JSON.parse(t)}static set storedSettings(t){Spicetify.LocalStorage.set(this.settingId,JSON.stringify(t))}}).settingId="jukebox:settings",Tt=class extends Error{},At=class{constructor(){this._songState=null,this.songStateSubject=new wt(null),this.songState$=this.songStateSubject.asObservable(),this.driver=null,this.songChangedSubscription=new a,this.driverProcessSubscription=new a,this.statsChangedSubject=new g,this.statsChanged$=this.statsChangedSubject.asObservable(),this.stateChangedSubject=new wt(!1),this.stateChanged$=this.stateChangedSubject.asObservable(),this.settings=Nt.settings}get songState(){return this._songState}set songState(t){this._songState=t,this.songStateSubject.next(t)}get isEnabled(){return this.stateChangedSubject.value}async setEnabled(t){t?await this.enable():this.disable()}async reloadSettings(){this.settings=Nt.settings,this.isEnabled&&(this.stop(),await this.start())}async enable(){this.stateChangedSubject.next(!0);var t=ve(Spicetify.Player,"songchange").subscribe(()=>{this.stop(),this.start()});this.songChangedSubscription.add(t),await this.start()}disable(){this.stop(),this.songChangedSubscription.unsubscribe(),this.songChangedSubscription=new a,this.stateChangedSubject.next(!1)}stop(){var t;null!=(t=this.driver)&&t.stop(),this.driver=null,this.driverProcessSubscription.unsubscribe(),this.driverProcessSubscription=new a,this.songState=null}async start(){var e=Spicetify.Player.data.item;if(void 0!==e){Spicetify.showNotification("Fetching analysis for song...");var n=Spicetify.URI.fromString(e.uri);if(Spicetify.URI.isLocalTrack(n))this.disableWithError("No analysis available for local tracks.");else if(Spicetify.URI.isEpisode(n))this.disableWithError("No analysis available for shows.");else{var r,n=null!=(r=null!=(r=(n=n)._base62Id)?r:n.id)?r:null;if(null===n)this.disableWithError("Couldn't get track id.");else{let t=null;try{t=await Se(n)}catch(t){}null===t||0===t.beats.length?this.disableWithError("No analysis available for this track."):(r=new st(t).remixTrack(),n=new Ot(this.settings,r.beats).generateGraph(),this.songState=new at(e,r,n),this.driver=new jt(this.songState,this.settings),this.driverProcessSubscription.add(this.driver.onProgress$.subscribe(()=>{var t;this.statsChangedSubject.next({beatsPlayed:null!=(t=null==(t=this.songState)?void 0:t.beatsPlayed)?t:0,currentRandomBranchChance:null!=(t=null==(t=this.songState)?void 0:t.currentRandomBranchChance)?t:0,listenTime:null!==this.songState?(new Date).getTime()-this.songState.startTime:0})})),this.driver.start())}}}}disableWithError(t){Spicetify.showNotification(t,!0),this.disable()}},w=r(i()),S=r(i()),Mt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},Lt="Infinity",It=[["path",{d:"M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",key:"1z0uae"}]],(t=(0,S.forwardRef)(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:i="",children:s,...a},o)=>(0,S.createElement)("svg",{ref:o,...Mt,width:e,height:e,stroke:t,strokeWidth:r?24*Number(n)/Number(e):n,className:["lucide","lucide-"+Lt.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i].join(" "),...a},[...It.map(([t,e])=>(0,S.createElement)(t,e)),...Array.isArray(s)?s:[s]]))).displayName=""+Lt,$t=t,x=r(i(),1),zt=(()=>"undefined"==typeof window?x.useEffect:x.useLayoutEffect)(),Ft=t=>t[1]?.next?t[1]:{next:t[1],error:t[2],complete:t[3]},qt=r(i()),(async()=>{for(window.jukebox=new At;null==Spicetify||!Spicetify.Platform;)await new Promise(t=>setTimeout(t,100));await 0;try{o=".player-controls__right",u=null,l=!(c=5e3);var t=await new Promise((e,n)=>{let r=document.querySelector(o);if(null!==r)l&&console.log("found element in querySelector"),e(r);else{let t=new MutationObserver(()=>{null!==(r=document.querySelector(o))&&(l&&console.log("found element in observer"),e(r),t.disconnect())});null===u&&(u=document.body),t.observe(u,{childList:!0,subtree:!0}),setTimeout(()=>{null===r&&(l&&console.log("trying to find element from querySelector again"),t.disconnect(),null!==(r=document.querySelector(o))?e(r):n(new Error(`Couldn't find the element "${o}".`)))},c)}});n=qt.default.createElement(Be,null),s=t,a=K.default.createRoot(document.createElement("div")),n=K.default.createPortal(n,s),a.render(n);{var e="0.1.0";var r="eternal-jukebox";var i=await Wt("History");let n=async()=>{await Jt(e,r)||Spicetify.showNotification("📢 A new version of the custom app is available.",!1,5e3)};if(i.location.pathname==="/"+r)await n();else{let e=null;e=i.listen(async t=>{t.pathname==="/"+r&&(await n(),null!=e)&&e()})}}}catch(t){console.error(t),Spicetify.showNotification("Failed to register the eternal jukebox playbar button",!0)}var n,s,a,o,c,u,l})()})();